<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>libevdev: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libevdev
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">A wrapper library for evdev devices</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">libevdev Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>libevdev</b> is a library for handling evdev kernel devices. It abstracts the ioctls through type-safe interfaces and provides functions to change the appearance of the device.</p>
<h1>Handling events and SYN_DROPPED</h1>
<p>libevdev provides an interface for handling events, including most notably SYN_DROPPED events. SYN_DROPPED events are sent by the kernel when the process does not read events fast enough and the kernel is forced to drop some events. This causes the device to get out of sync with the process' view of it. libevdev handles this by telling the caller that a SYN_DROPPED has been received and that the state of the device is different to what is to be expected. It then provides the delta between the previous state and the actual state of the device as a set of events. See <a class="el" href="group__events.html#gabb96c864e836c0b98788f4ab771c3a76" title="Get the next event from the device.">libevdev_next_event()</a> for more information.</p>
<h1>Signal safety</h1>
<p>libevdev is signal-safe for the majority of its operations. Check the API documentation to make sure, unless explicitly stated a call is <b>not</b> signal safe.</p>
<h1>Device handling</h1>
<p>libevdev does not attempt duplicate detection. Initializing two libevdev devices for the same fd is valid and behaves the same as for two different devices.</p>
<p>libevdev does not handle the file descriptors directly, it merely uses them. The caller is responsible for opening the file descriptors, setting them to O_NONBLOCK and handling permissions.</p>
<h1>Where does libevdev sit?</h1>
<p>libevdev is essentially a read(2) on steroids for /dev/input/eventX devices. It sits below the process that handles input events, in between the kernel and that process. In the simplest case, e.g. an evtest-like tool the stack would look like this: </p>
<pre class="fragment"> kernel → libevdev → evtest
</pre><p>For X.Org input modules, the stack would look like this: </p>
<pre class="fragment"> kernel → libevdev → xf86-input-evdev → X server → X client
</pre><p>For Weston/Wayland, the stack would look like this: </p>
<pre class="fragment"> kernel → libevdev → Weston → Wayland client
</pre><p>libevdev does <b>not</b> have knowledge of X clients or Wayland clients, it is too low in the stack.</p>
<h1>Example</h1>
<p>Below is a simple example that shows how libevdev could be used. This example opens a device, checks for relative axes and a left mouse button and if it finds them monitors the device to print the event.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>libevdev *dev = NULL;</div>
<div class="line"><span class="keywordtype">int</span> fd;</div>
<div class="line"><span class="keywordtype">int</span> rc = 1;</div>
<div class="line"></div>
<div class="line">fd = open(<span class="stringliteral">&quot;/dev/input/event0&quot;</span>, O_RDONLY|O_NONBLOCK);</div>
<div class="line">rc = <a class="code" href="group__init.html#ga89bb5bce1c23e293293484b05b12aaf4" title="Initialize a new libevdev device from the given fd.">libevdev_new_from_fd</a>(fd, &amp;dev);</div>
<div class="line"><span class="keywordflow">if</span> (rc &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to init libevdev (%s)\n&quot;</span>, strerror(-rc));</div>
<div class="line">        exit(1);</div>
<div class="line">}</div>
<div class="line">printf(<span class="stringliteral">&quot;Input device name: \&quot;%s\&quot;\n&quot;</span>, <a class="code" href="group__bits.html#gaed0328c67b7a78422636d9fe09a73f12">libevdev_get_name</a>(dev));</div>
<div class="line">printf(<span class="stringliteral">&quot;Input device ID: bus %#x vendor %#x product %#x\n&quot;</span>,</div>
<div class="line">                <a class="code" href="group__bits.html#gae830487f7b51b8365a8ea5d6c4c4f5d3">libevdev_get_bustype</a>(dev),</div>
<div class="line">                <a class="code" href="group__bits.html#ga2246b7c4dd03b739a60933eb3110be1d">libevdev_get_vendor_id</a>(dev),</div>
<div class="line">                <a class="code" href="group__bits.html#ga45f43e6dcab864c565391ffd8e02e2b1">libevdev_get_product_id</a>(dev));</div>
<div class="line"><span class="keywordflow">if</span> (!<a class="code" href="group__bits.html#ga398bef155fa4a0cfb832de30723ebd14">libevdev_has_event_type</a>(dev, EV_REL) ||</div>
<div class="line">    !<a class="code" href="group__bits.html#gab2ab9dad417f33daa79fa0c3d682df0b">libevdev_has_event_code</a>(dev, EV_KEY, BTN_LEFT)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;This device does not look like a mouse\n&quot;</span>);</div>
<div class="line">        exit(1);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keyword">struct </span>input_event ev;</div>
<div class="line">        rc = <a class="code" href="group__events.html#gabb96c864e836c0b98788f4ab771c3a76" title="Get the next event from the device.">libevdev_next_event</a>(dev, <a class="code" href="libevdev_8h.html#a91c53c94148902faf9391bb4aa320299a7d73c32e0a017a2816dfeff0b8f7343b" title="Process data in normal mode.">LIBEVDEV_READ_NORMAL</a>, &amp;ev);</div>
<div class="line">        <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line">                printf(<span class="stringliteral">&quot;Event: %s %s %d\n&quot;</span>,</div>
<div class="line">                                <a class="code" href="group__misc.html#ga51b8e608d734e1c64eb2e3de61ddf6ed">libevdev_get_event_type_name</a>(ev.type),</div>
<div class="line">                                <a class="code" href="group__misc.html#ga610a6eeabce2de2e2cef66a26d9cd7dc">libevdev_get_event_code_name</a>(ev.type, ev.code),</div>
<div class="line">                                ev.value);</div>
<div class="line">} <span class="keywordflow">while</span> (rc == 1 || rc == 0 || rc == -EAGAIN);</div>
</div><!-- fragment --><p>A more complete example is available with the libevdev-events tool here: <a href="https://github.com/whot/libevdev/blob/master/tools/libevdev-events.c">https://github.com/whot/libevdev/blob/master/tools/libevdev-events.c</a></p>
<h1>libevdev internal test suite</h1>
<p>libevdev's internal test suite uses the Check unit testing framework (<a href="http://check.sourceforge.net/">http://check.sourceforge.net/</a>). Tests are divided into test suites and test cases. Most tests create a uinput device, so you'll need to run as root.</p>
<p>To run a specific suite only, export <code>CK_RUN_SUITE="suite name"</code>. To run a specific test case only, export <code>CK_RUN_TEST="test case name"</code>.</p>
<p>To get a list of all suites or tests, run <code>git grep suite_create</code> or <code>git grep tcase_create</code>, respectively.</p>
<p>By default, check forks, making debugging harder. Run gdb as below to avoid forking. sudo CK_FORK=no CK_RUN_TEST="test case name" gdb ./test/test-libevdev</p>
<p>A special target <code>make gcov-report.txt</code> exists that runs gcov and leaves a <code>libevdev.c.gcov</code> file. Check that for test coverage.</p>
<p><code>make check</code> is hooked up to run the test and gcov (again, needs root).</p>
<p>The test suite creates a lot of devices, very quickly. Add the following xorg.conf.d snippet to avoid the devices being added as X devices (at the time of writing, mutter can't handle these devices and exits). </p>
<pre class="fragment">$ cat /etc/X11/xorg.conf.d/99-ignore-libevdev-devices.conf
     Section "InputClass"
             Identifier "Ignore libevdev test devices"
             MatchProduct "libevdev test device"
             Option "Ignore" "on"
     EndSection</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jul 5 2013 09:26:29 for libevdev by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
